name: Breadcrumb Navigation Check

on:
  pull_request:
    paths:
      - "**/*.html"
      - "tools/design-linters/breadcrumb_linter.py"
      - ".github/workflows/breadcrumb-check.yml"
  push:
    branches: [main, develop]
    paths:
      - "**/*.html"
      - "tools/design-linters/breadcrumb_linter.py"
      - ".github/workflows/breadcrumb-check.yml"

jobs:
  breadcrumb-check:
    name: Check HTML Documentation Breadcrumbs
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Run breadcrumb linter
        run: |
          echo "🔍 Checking HTML documentation for breadcrumb navigation..."
          python tools/design-linters/breadcrumb_linter.py

      - name: Comment on PR if failed
        if: failure() && github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const message = `## ❌ Breadcrumb Navigation Check Failed

            HTML documentation files are missing proper breadcrumb navigation.

            ### 📚 How to Fix:
            Add breadcrumb navigation to each HTML document:

            \`\`\`html
            <nav class="breadcrumb" aria-label="Breadcrumb navigation">
                <a href="/">🏠 Home</a>
                <span class="breadcrumb-separator">›</span>
                <a href="/parent">Parent Section</a>
                <span class="breadcrumb-separator">›</span>
                <span class="breadcrumb-current">Current Page</span>
            </nav>
            \`\`\`

            ### 🎯 Why This Matters:
            - **Better UX**: Users can easily navigate through documentation hierarchy
            - **Accessibility**: Screen readers can understand document structure
            - **Consistency**: All documentation follows the same navigation pattern

            Run \`make lint-breadcrumbs\` locally to see specific violations.`;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: message
            });

      - name: Success notification
        if: success()
        run: |
          echo "✅ All HTML documentation has proper breadcrumb navigation!"
